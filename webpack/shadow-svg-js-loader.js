// Generated by CoffeeScript 1.12.7
var SvgCompiler, debug, fs, utils;

utils = require('loader-utils');

debug = require('debug')('loader/svg');

fs = require('fs');

SvgCompiler = (function() {
  function SvgCompiler() {}

  SvgCompiler.prototype.compile = function(cssData, resource, uniqueStr) {
    var jsString;
    jsString = this.compileJsString(fs.readFileSync(resource, "utf8"), uniqueStr);
    return cssData + "\n" + jsString;
  };

  SvgCompiler.prototype.getUniqueStr = function(context) {
    var uniqueStr;
    return 'asdf';
    uniqueStr = utils.getOptions(context).uniqueStr;
    if (uniqueStr == null) {
      return "";
    } else {
      return uniqueStr;
    }
  };

  SvgCompiler.prototype.compileJsString = function(data, uniqueStr) {
    var fileName, namespace;
    fileName = "some-files";
    namespace = fileName + "-svg ";
    data = data.replace(/<\?xml.+/g, '');
    data = data.replace(/<!-- Gen.+/g, '');
    data = data.replace(/<!DOC.+/g, '');
    data = data.replace(/<style[\s\S]*<\/style>/g, '');
    data = data.replace(/(class="st[0-9]+)/g, "$1_" + uniqueStr);
    data = data.replace(/(SVGID_[0-9]+_)/g, "$1" + uniqueStr);
    data = data.replace(/<text(.+?(class="(.+?)"|<tspan)+?(.+?<tspan.+?class="(.+?)"))/g, '<text class="$3 $5" $1');
    data = data.replace(/<tspan.+?>(.+?)<\/tspan>/g, '$1');
    data = data.replace(/(<g id=".+)_x60_(.+?)x(.+?)"/g, '$1" data-size="$2x$3"');
    data = data.replace(/_x5F_/g, '_');
    data = data.replace(/id="(.+)?_x[23]E_(.+?)"/g, 'id="$1" class="$2" ');
    data = data.replace(/class="([a-z0-9\-_]+)"\s+class="([a-z0-9\-_]+)"/g, 'class="$1 $2"');
    data = data.replace(/id=""/g, '');
    data = data.replace(/(<g id.+")/g, "$1 class=\"" + namespace + "\"");
    data = data.replace(/_x2C_/g, ' ');
    data = data.replace(/class="(.+)_[0-9]+_(.*)"/g, 'class="$1 $2"');
    data = data.replace(/\/>\s+/g, '/>');
    data = data.replace(/\n|\r/g, '');
    data = data.replace(/<svg.+?>([\s\S]*)<\/svg>/g, '$1');
    data = data.replace(/([\s\S]*)/g, "window.pxSvgIconString = window.pxSvgIconString || ''; window.pxSvgIconString+='$1';");
    return data;
  };

  return SvgCompiler;

})();

module.exports = function(data) {
  var compiler, uniqueStr;
  compiler = new SvgCompiler();
  uniqueStr = compiler.getUniqueStr(this);
  return compiler.compile(data, this.resource, uniqueStr);
};
